@inherits ShowListBase

<div class="d-flex justify-content-between align-items-center flex-wrap">
    <h1>
        @(
            Type switch
            {
                "booksales" => "Sách",
                "authors" => "Tác giả",
                "bills" => "Hóa đơn",
                "users" => "Người dùng",
                _ => "Không xác định"
            }
            )
    </h1>
    <div class="d-flex align-content-center">
        <div class="d-flex align-items-center me-3">
            <MudSelect @bind-Value="pageSize" Style="width: 75px;" Variant="Variant.Outlined">
                <MudSelectItem Value="5">5</MudSelectItem>
                <MudSelectItem Value="10">10</MudSelectItem>
                <MudSelectItem Value="15">15</MudSelectItem>
                <MudSelectItem Value="20">20</MudSelectItem>
            </MudSelect>
        </div>
        @if (Type != "bills")
        {
            <MudTextField @bind-Value="searchText"
                          Label="Tìm kiếm"
                          Variant="Variant.Outlined"
                          Style="width: 200px;" />
        }
    </div>
</div>

@if (items == null)
{
    <p><em>Loading...</em></p>
}
else if (!items.Any())
{
    <p>Không có dữ liệu~~</p>
}
else
{
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                @if (Type == "booksales")
                {
                    <th>Tên sách</th>
                    <th>Số lượng</th>
                    <th>Giá</th>
                    <th>Tên tác giả</th>
                    <th>Hành động</th>
                }
                else if (Type == "authors")
                {
                    <th>Tên tác giả</th>
                    <th>Xem Sách</th>
                     <AuthorizeView Roles="Admin,Staff">
                    <th>Hành động</th>
                    </AuthorizeView>
                }
                else if (Type == "bills")
                {
                    <th>Tổng giá</th>
                    <th>Ngày tạo</th>
                     <AuthorizeView Roles="Admin,Staff">
                    <th>Chi tiết</th>
                    </AuthorizeView>
                }
                else if (Type == "users")
                {
                    <th>Tên đăng nhập</th>
                    <th>Email</th>
                    <th>Vai trò</th>
                    <th>Trạng thái</th>
                    <th>Thay đổi vai trò</th>
                    <th>Khóa</th>

                }
            </tr>
        </thead>
        <tbody>
            @if (Type == "booksales")
            {
                foreach (BookSale sale in pagedItems)
                {
                    <tr>
                        <td>@sale.Id</td>
                        <td>@sale.Title</td>
                        <td>@sale.Quantity.ToString("n0")</td>
                        <td>@sale.Price.ToString("c0")</td>
                        <td>@sale.Author?.AuthorName</td>
                        <AuthorizeView Roles="Admin,Staff">
                            <td>
                                <MudButton Color="Color.Primary" OnClick="() => UpdateItem(sale.Id)" >Sửa</MudButton>
                                <MudButton Color="Color.Error" OnClick="() => DeleteItem(sale.Id)" >Xóa</MudButton>
                            </td>
                        </AuthorizeView>
                    </tr>
                }
            }
            else if (Type == "authors")
            {
                foreach (Author author in pagedItems)
                {
                    <tr>
                        <td>@author.Id</td>
                        <td>@author.AuthorName</td>
                        <td>
                            <MudButton Color="Color.Info" OnClick="() => ShowAllBookSalesFromAuthor(author.Id)" >Xem</MudButton>
                        </td>
                        <AuthorizeView Roles="Admin,Staff">
                            <td>
                                <MudButton Color="Color.Primary" OnClick="() => UpdateItem(author.Id)" >Sửa</MudButton>
                                <MudButton Color="Color.Error" OnClick="() => DeleteItem(author.Id)" >Xóa</MudButton>

                            </td>
                        </AuthorizeView>
                    </tr>
                }
            }
            else if (Type == "bills")
            {
                foreach (Bill bill in pagedItems)
                {
                    <tr>
                        <td>@bill.Id</td>
                        <td>@bill.TotalPrice.ToString("c0")</td>
                        <td>@bill.DateCreated</td>
                        <td>
                            <MudButton Color="Color.Success" OnClick="() => ShowBillDetails(bill.Id)" >Chi tiết</MudButton>
                        </td>
                    </tr>
                }
            }
            else if (Type == "users")
            {
                foreach (User user in pagedItems)
                {
                    <tr>
                        <td>@user.Id</td>
                        <td>@user.UserName</td>
                        <td>@user.Email</td>
                        <td>@user.Role?.RoleName</td>
                        <td class="@(user.IsActive ? "" : "text-danger")">@(user.IsActive ? "Đang hoạt động" : "Bị khóa")</td>
                        <td>
                            <MudButton Color="Color.Primary" OnClick="() => ShowChangeRole(user.Id)" >Thay đổi</MudButton>
                        </td>
                        <td>
                            <MudButton Color="Color.Warning" OnClick="() => SetUserStatus(user.Id, !user.IsActive)" >
                                @(user.IsActive ? "Khóa" : "Mở khóa")
                            </MudButton>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>

    <div class="d-flex justify-content-center align-items-center">
        <button class="btn btn-secondary me-2" @onclick="PreviousPage" disabled="@(currentPage == 1)">Prev</button>
        <span class="text-center py-2">Page @currentPage of @((totalItems + pageSize - 1) / pageSize)</span>
        <button class="btn btn-secondary ms-2" @onclick="NextPage" disabled="@(currentPage >= (totalItems + pageSize - 1) / pageSize)">Next</button>
    </div>

    <div class="d-flex justify-content-center align-items-center mt-3">
        <label for="pageNumber" class="me-2">Đi đến trang:</label>
        <input type="number" id="pageNumber" min="1" max="@((totalItems + pageSize - 1) / pageSize)" @bind="currentPage" class="form-control" style="width: 75px;" />
    </div>
}

@if (Type == "users")
{
    <ChageRoleModal IsVisible="IsModalVisible" OnClose="CloseModal" SelectedUser="SelectedUser" OnChangeRole="HandleChangeRole" />
}
else if (Type == "bills")
{
    <BillDetailModal IsVisible="IsModalVisible" SelectedBill="SelectedBill" OnClose="CloseModal" />
}
